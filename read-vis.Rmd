# Visualisation of mapped sequencing reads

```{R message=F}
library(ggplot2)
library(dplyr)
library(purrr)

if (!require(ape)) {
  install.packages("ape")
  library(ape)
}


```

```{R}
genome <- read.dna("data/Ecoli_genome.fasta",format="fasta")
sequence <- as.character(genome)
genome_length <- length(sequence)
```

## Importing data from /output/*.csv
Import and formatting fo data to be used for vizualisation!
```{R}
mapped <- read.csv("output/2023-01-27_NC_000913.3 Escherichia coli str. K-12 substr. MG1655, complete genome.csv",sep = ";")

# mapped = mapped[50:60,]

mapped = mapped %>% mutate_at(vars(Sense, Antisense), ~map(strsplit(. ,split=","), ~map_int(.x, as.integer)))
mapped %>% str()

sense = unlist(mapped$Sense)
anti = unlist(mapped$Antisense)

sense %>% length()
anti %>% length()

reads <- data.frame(pos = c(sense, anti), strand = as.factor(rep(c("s","a"),times = c(length(sense),length(anti)))))

```

## Plotting mapped reads
```{R}

ggplot(reads, aes(x = pos, y = ..density..)) +
  geom_histogram(bins = 155, color = "green4", fill = "green2") + 
  geom_density(color = "darkgreen", lwd=1.3, bw = 70000)+
                 # geom_histogram(reads)
  labs(x = "Genome Position in Mb", y = "Density of reads mapped", caption = "Fig. 1: Density of the reads mapped to the E.coli genome.") +
  # scale_y_reverse(limits = c(0,12)) + 
  theme_classic() +
  theme(text = element_text(size = 20)) 
```
Description Fig x: Density of reads mapped to the E.coli genome. Each bin size represents a 30 kb long segment along the genome.

```{R}
ggplot(reads) +
  geom_histogram(data = reads[reads$strand == "s",],aes(x = pos/10^6, y = ..count..), bins = 155,color="lightblue",fill="blue") +
  # geom_density(data = reads[reads$strand == "s",], color="lightblue") +
  geom_histogram(data = reads[reads$strand == "a",],aes(x = pos/10^6, y = -..count..), bins = 155,color="orange",fill="red") +
  scale_y_continuous(labels = abs) + 
  labs(x = "Genome Position in Mb", y = "reads mapped per 30 Kb segment", caption = "Fig 2: Orientation of mapped Reads") +
  theme_classic() +
  theme(text = element_text(size = 20)) 
```
Description Fig x2: Sense vs. Antisense density of mapped reads. The y-axis shows a number of counts per 30 Kb segment. 
